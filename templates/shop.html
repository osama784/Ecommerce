{% extends 'main.html'%}
{% load static %}

{% block head%}
<title>Shop</title>
{% endblock head %}


{% block content %}
{% include "partials/navbar.html" with chosen="shop" %}

{% include "partials/path.html" with parent_page_name="Shop"%}
<div class="container mx-auto px-4 my-10 xl:max-w-7xl"> 
    <div class="flex flex-col gap-10" x-data="{products: [], vendors: [], categories: []}" x-init="products = await (await fetch('{% url 'api:get-products' %}')).json()" >
        <div class="flex gap-10 flex-wrap justify-around *:h-fit *:shadow *:rounded-lg *:border *:py-5 *:px-10 *:grow">
            <div class="flex flex-col gap-3 max-w-72">
                <h2 class="font-bold text-lg">By Vendors</h2>
                <div class="flex flex-col gap-4 *:py-1">
                    {% for vendor in vendors %}
                        <div>
                            <input type="checkbox" name="{{vendor.name}}" id="{{vendor.name}}" value="{{vendor.name}}" 
                            x-on:change="$el.checked ? vendors.push({{vendor.pk}}) : vendors.splice(vendors.indexOf({{vendor.pk}}), 1);
                                        checkLengths ?  products = await (await fetch(`{% url 'api:get-products' %}?${generateParams('categories', categories)}${generateParams('vendors', vendors)}`)).json() : products = await (await fetch('{% url 'api:get-products' %}')).json()">
                            <label for="{{vendor.name}}">{{vendor.name|capfirst}}</label>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <div class="flex flex-col gap-3 max-w-72 items-center" x-data="{numberOfTags: 5}">
                <h2 class="font-bold text-lg">Popular Tags</h2>
                <p x-text="`${numberOfTags} tags`"></p>
                <div class="flex flex-col gap-5 *:border *:py-1 *:px-2 *:rounded-xl *:shadow *:w-fit text-sm">
                    {% for category in categories|slice:"5" %}
                    <div class="text-green-600 hover:-translate-y-1 transition-transform flex items-center gap-1"
                        x-data="{isChosen : false}">
                        <div x-on:click="isChosen = !isChosen;
                                        isChosen ? numberOfTags++ : numberOfTags--;
                                        isChosen ? categories.push('{{category.0}}') : categories.splice(categories.indexOf('{{category.0}}', 1));
                                        checkLengths ?  products = await (await fetch(`{% url 'api:get-products' %}?${generateParams('categories', categories)}${generateParams('vendors', vendors)}`)).json() : products = await (await fetch('{% url 'api:get-products' %}')).json()">
                            <i class="fa-solid fa-xmark text-slate-300 cursor-pointer hover:text-black transition-colors"
                                x-bind:class="!isChosen && 'rotate-45' "></i>
                        </div>
                        <p>{{category.1}}</p>
                    </div>
                    {% endfor %}
                    <hr>
                    <a href="">see all categories</a>
                </div>
            </div>
            <div class="max-w-80 flex flex-col gap-3 justify-between">
                    <h2 class="font-bold text-lg">By Price</h2>
                    <div class="flex flex-col gap-2">
                        <div class="h-2 w-full bg-green-500 rounded"></div>
                        <div class="flex justify-between text-gray-500">
                            <small>From: <span class="text-green-500">$10.23</span></small><small>To:
                                <span class="text-green-500">$777.00</span></small>
                        </div>
                        <input type="number" class="w-full rounded border h-12 px-3 shadow" value="10.90">
                        <button
                            class="w-full text-center text-white bg-green-600 mt-5 rounded py-2 shadow-sm hover:bg-amber-500 transition-colors">Filter</button>
                    </div>
                
            </div>
        </div>
        <div class="rounded-lg flex flex-col gap-y-4">
            <div class="flex flex-wrap justify-between items-center gap-5 w-full relative">
                <h3 class="text-lg">There are {{products.count }} products available!</h3>
            </div>
            <div class="grid max-[430px]:grid-cols-2 grid-cols-4 md:grid-cols-6 lg:grid-cols-8 xl:grid-cols-10 gap-3">
                 {% for product in products%}               
                    {% include 'partials/product-partial.html' with product=product %}
                 {% endfor %}
            </div>
        </div>
    </div>
</div>


<script>
    function generateParams(key, values) {
        let params = '';
        values.forEach(element => {
            params += `${key}=${element}&`;
        });
        return params
    }

    function checkLengths(categories, vendors) {
        if (categories.length == 0 || vendors.length == 0) {
            return false
        }
        return true
    }
</script>

{% include 'partials/footer.html'%}

{% endblock content %}